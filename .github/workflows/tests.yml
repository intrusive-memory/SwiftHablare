name: Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    name: Run Tests
    runs-on: macos-15
    env:
      DEVELOPER_DIR: /Applications/Xcode_16.4.app/Contents/Developer
      TOOLCHAINS: swift

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Select Xcode 16.4
      run: sudo xcode-select -s /Applications/Xcode_16.4.app/Contents/Developer

    - name: Install Swift 6.2 toolchain
      run: |
        curl -L -o /tmp/swift-6.2-RELEASE-osx.pkg \
          https://download.swift.org/swift-6.2-release/xcode/swift-6.2-RELEASE/swift-6.2-RELEASE-osx.pkg
        sudo installer -pkg /tmp/swift-6.2-RELEASE-osx.pkg -target /
        rm /tmp/swift-6.2-RELEASE-osx.pkg

    - name: Show Swift version
      run: swift --version

    - name: Build
      run: swift build

    - name: Run tests
      run: swift test
